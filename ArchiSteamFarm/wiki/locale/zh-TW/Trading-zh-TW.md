# 交易

ASF支援Steam的非互動式（離線）交易。 您可以直接接收（接受／拒絕）及發送交易，不需要特殊設定。但顯而易見，這需要不受限制的Steam帳號（需已在商店中消費滿$5美元）。 受限制的帳號僅能使用有限的交易功能。

---

## 邏輯

ASF始終會接受來自具有&#8203;`Master`&#8203;（或更高）存取權限的使用者發送的所有交易提案，無論交易物品為何。 這不只可以輕鬆收集Bot實例掛出的Steam交換卡片，還能簡單管理Bot存放在物品庫中的Steam物品⸺包含來自其他遊戲（例如CS:GO）的物品。

ASF將拒絕來自交易模組黑名單的任何（非Master）使用者的交易提案，無論交易物品為何。 黑名單儲存在&#8203;`BotName.db`&#8203;標準資料庫中，可以透過&#8203;`tb`&#8203;、&#8203;`tbadd`&#8203;及&#8203;`tbrm`&#8203;**[指令](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Commands-zh-TW)**&#8203;進行管理。 這應該能夠代替Steam提供的標準使用者封鎖，請謹慎使用。

ASF將接受所有透過Bot發送類似於&#8203;`loot`&#8203;的交易，除非在&#8203;`TradingPreferences`&#8203;中設定了&#8203;`DontAcceptBotTrades`&#8203;。 簡而言之，&#8203;`TradingPreferences`&#8203;中預設的&#8203;`None`&#8203;會使ASF自動接受來自具有&#8203;`Master`&#8203;存取權限Bot的使用者的交易（如上所述），以及ASF同一程序中其他Bot的所有贈禮交易。 若您想停用來自其他Bot的贈禮交易，那麼您應在&#8203;`TradingPreferences`&#8203;中設定&#8203;`DontAcceptBotTrades`&#8203;。

當您在&#8203;`TradingPreferences`&#8203;中設定&#8203;`AcceptDonations`&#8203;後，ASF還將接受任何贈禮交易：Bot帳號不會失去任何物品的交易。 這個屬性只影響非Bot帳號，因為Bot帳號是受&#8203;`DontAcceptBotTrades`&#8203;的影響。 `AcceptDonations`&#8203;使您能夠輕鬆地接受來自其他使用者，及不在同一ASF程序中Bot的贈禮。

值得一提的是，&#8203;`AcceptDonations`&#8203;不需要&#8203;**[ASF雙重驗證](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Two-factor-authentication-zh-TW)**&#8203;，因為如果我們沒有失去任何物品，則無需進行交易確認。

您還可以透過修改相應的&#8203;`TradingPreferences`&#8203;來進一步自訂ASF的交易功能。 `TradingPreferences`&#8203;的其中一個主要功能是&#8203;`SteamTradeMatcher`&#8203;選項，它將使ASF使用內建邏輯來接受交易，並幫助您完成缺少的徽章，這在結合&#8203;**[SteamTradeMatcher](https://www.steamtradematcher.com)**&#8203;的公開清單使用時特別有用，但它也能單獨運作。 我們將在下面進一步說明。

---

## `SteamTradeMatcher`

當啟用&#8203;`SteamTradeMatcher`&#8203;時，ASF將使用相當複雜的演算法，來檢查交易是否通過STM規則，且對我們而言是否公平。 具體的邏輯是：

- 如果我們會失去&#8203;`MatchableTypes`&#8203;之外的任何物品，則拒絕交易。
- 對於每個遊戲、物品類型及稀有度，如果我們獲得的物品數量少於失去的數量，則拒絕交易。
- 如果使用者想要交易特殊的Steam夏季／冬季特賣交換卡片，但有交易託管，則拒絕交易。
- 如果交易的託管時間達到全域設定屬性&#8203;`MaxTradeHoldDuration`&#8203;的值，則拒絕交易。
- 如果我們沒有設定&#8203;`MatchEverything`&#8203;，且交易內容對我們不利，則拒絕交易。
- 如果未被上述任何規則拒絕，則接受交易。

值得一提的是，ASF還支援溢價支付：只要滿足上述所有條件，在使用者向交易內容提供額外物品時，邏輯也會正常運作。

前四個拒絕條件應該是顯而易見的。 最後一個含有實際的重複邏輯，它檢查我們物品庫的當前狀態，再決定交易狀態。

- 如果交易會使您的徽章進度增加，則為&#8203;**有利**&#8203;。 例如：A A（交易前）-> A B（交易後）
- 如果交易並不影響您的徽章進度，則為&#8203;**均衡**&#8203;。 例如：A B（交易前）-> A C（交易後）
- 如果交易會使您的徽章進度減少，則為&#8203;**不利**&#8203;。 例如：A C（交易前）-> A A（交易後）

STM只會處理有利的交易，也就是說使用STM進行重複卡片比對的使用者，只能發送對我們有利的交易。 然而，ASF的機制更加自由，它也接受均衡交易，因為在這種交易中，我們並沒有實際上的損失，所以沒有理由拒絕它們。 這對好友之間的交易特別有用，因為他們可以在不使用STM的情形下，交換您多餘的卡片，且不影響您的徽章進度。

預設情形下，ASF會拒絕不利的交易⸺這是做為普通使用者的您所想要的。 但是，您仍可以在&#8203;`TradingPreferences`&#8203;中設定&#8203;`MatchEverything`&#8203;，使ASF接受所有重複物品交易，包含&#8203;**不利交易**&#8203;。 只有當您想要在您的帳號執行1:1交易的Bot時，這個功能才有用，因為您曉得&#8203;**ASF將不再幫您完成徽章進度，且可能會因N張重複卡片，而使您損失收集進度**&#8203;。 若您有意執行一個&#8203;**從不打算**&#8203;完成任何徽章進度，且會向每個想交易的使用者提供全部物品庫物品的交易Bot，那麼您可以啟用這個選項。

不論您如何設定&#8203;`TradingPreferences`&#8203;，被ASF拒絕的交易並不代表您無法自行接受。 若您保留&#8203;`BotBehaviour`&#8203;的預設值，裡面並不包含&#8203;`RejectInvalidTrades`&#8203;，ASF將忽略這些交易，讓您自行決擇。 同樣適用於&#8203;`MatchableTypes`&#8203;及其之外的物品，這個模組只用來幫助您自動化STM交易，而不是用來判斷交易的利弊。 這個規則的唯一例外是，被您使用&#8203;`tbadd`&#8203;指令加入交易模組黑名單的使用者：不論&#8203;`BotBehaviour`&#8203;如何設定，來自這些使用者的交易都會被立即拒絕。

強烈建議您，在啟用這個選項時使用&#8203;**[ASF雙重驗證](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Two-factor-authentication-zh-TW)**&#8203;，因為如果您還需要手動確認每筆交易，這個功能也將會失去它的特點。 即使無法確認交易，&#8203;`SteamTradeMatcher`&#8203;也能正常運作，但若您沒有及時手動確認，就會積欠許多確認請求。