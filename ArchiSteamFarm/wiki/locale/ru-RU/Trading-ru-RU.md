# Торговля

ASF включает в себя поддержку не-интерактивных (офлайн) обменов Steam. Как получение (принятие/отклонение) так и отправка обменов работают не требуя дополнительной настройки, однако, естественно, требуют аккаунт Steam без ограничений (такой, на котором потрачено больше чем 5$ в эквиваленте). Модуль обменов недоступен для ограниченных аккаунтов.

---

## Логика

ASF всегда принимает все обмены, независимо от предметов в них, присланные от пользователя с правами `Master` (или выше). Это позволяет не только легко забрать карты, которые нафармил бот, но также удобно манипулировать любыми предметами Steam, хранящимися на этом боте - включая предметы из других игр (таких как CS:GO).

ASF будет отказыватся от обменов, независимо от содержимого, которые присланы от пользователей(кроме `Master`) обмены с которыми запрещены в модуле обменов. Черный список хранится в стандартной базе данных `BotName.db`, и им можно управлять с помощью `tb`, `tbadd` и `tbrm` **[ команд](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Commands)**. Это может использоваться как альтернатив блокировке в Steam - используйте с осторожностью.

ASF будет принимать все `loot`-подобные обмены присланные от других ботов, за исключением случая когда в параметре `TradingPreferences` указано значение `DontAcceptBotTrades`. Вкратце, параметр `TradingPreferences` со значением по умолчанию `None` приведёт к тому, что ASF будет автоматически принимать обмены от пользователей с правами `Master` (описано выше) а также все безвозмездные обмены от других ботов, задействованых в этом процессе ASF. Если вы хотите отключить принятие безвозмездных обменов от других ботов, для этого служит значение `DontAcceptBotTrades` в параметре `TradingPreferences`.

Если вы добавите значение `AcceptDonations` в параметр `TradingPreferences`, ASF также будет принимать любые безвозмездные обмены - обмены, в которых бот не отдаёт никаких предметов. Это влияет только на обмены с не-ботами, поскольку боты на обмены с ботами влияет значение `DontAcceptBotTrades`. `AcceptDonations` позволяет вам легко принимать пожертвования от других людей, а также от ботов не задействованных в данном процессе ASF.

Приятно отметить, что `AcceptDonations` не требует наличия **[2ФА ASF](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Two-factor-authentication-ru-RU)**, поскольку если мы не отдаём предметов - подтверждение на мобильном не требуется.

Вы можете настроить другие возможности обменов в ASF изменяя параметр `TradingPreferences`. Одна из важных функций доступных в `TradingPreferences` - это значение `SteamTradeMatcher`, которое активирует встроенную логику принятия обменов, помогающих собирать карточки для создания значков, она особенно полезна в сочетании с публикацией своего профиля на сайте **[SteamTradeMatcher](https://www.steamtradematcher.com)**, но будет работать и без этого. Эта функция подробно описана ниже.

---

## `SteamTradeMatcher`

Если включено значение `SteamTradeMatcher`, ASF будет использовать довольно сложный алгоритм для проверки, удовлетворяет ли обмен правилам STM и является ли для нас как минимум нейтральным. Логика работы следующая:

- Отказ от обмена если мы отдаём что-то, что не указано в параметре `MatchableTypes`.
- Отказ от обмена если мы не получаем как минимум столько же предметов из определённой игры и того же типа и той же редкости.
- Отказ от обмена если у нас запрашивают предмет летней/зимней распродажи, и при этом у пользователя действует удержание обменов.
- Отказ от обмена если удержание обмена превышает указанное в параметре глобальной конфигурации `MaxTradeHoldDuration`.
- Отказ от обмена если не установлено значение `MatchEverything` и обмен для нас хуже, чем нейтральный.
- Принятие обмена если мы не отказались от него на одном из этапов выше.

Приятно отметить, что ASF также поддерживает переплату - логика будет нормально работать если мы получаем в обмене что-то дополнительно, если все другие условия соблюдены.

Первые 4 условия отказа должны быть очевидны для всех. Последнее условие включает собственно логику проверки дубликатов, которая проверяет наш текущий инвентарь и решает, каков статус этого обмена.

- Обмен **хороший** если наш прогресс к завершению значка увеличивается. Например: A A (до) -> A B (после)
- Обмен **нейтральный** если наш прогресс к завершению значка не меняется. Например: A B (до) -> A C (после)
- Обмен **плохой** если наш прогресс к завершению значка уменьшается. Например: A C (до) -> A A (после)

STM работает только с хорошими обменами, а значит пользователь, пользующийся STM для обмена дубликатов всегда будет предлагать нам только хорошие обмены. Однако, ASF имеет либеральную настройку, и принимает также нейтральные обмены, поскольку в этом случае мы ничего не теряем, поэтому нет реальных причин отклонять их. Это особенно полезно для ваших друзей, поскольку они смогут меняться на ваши лишние карточки вообще не используя STM, если вы при этом не теряете прогресс к завершению значка.

По умолчанию ASF будет отклонять плохие сделки - практически всегда это то, чего хочет пользователь. Однако, при желании вы можете включить значение `MatchEverything` в параметр `TradingPreferences` чтобы ASF принимал все обмены дубликатов, включая **плохие**. Это может быть полезным только если вы хотите сделать из своего аккаунта бота по обмену карт 1:1, и вы должны понимать, что в этом случае **ASF не поможет вашему прогрессу к завершению значков, и сделает возможным потерю уже собранного набора карт на N дубликатов одной и той же карты**. Если вы хотите намеренно запустить торгового бота, который **никогда** не будет завершать какой-либо набор и должен предлагать весь свой инвентарь каждому заинтересованному пользователю, вы можете включить эту опцию.

В зависимости от выбранных значений в параметре `TradingPreferences`, то, что ASF отказал в обмене не означает что вы не сможете принять её самостоятельно. Если вы оставили значение параметру `BotBehaviour` значение по умолчанию, которое не включает в себя `RejectInvalidTrades`, ASF будет просто игнорировать эти обмены - разрешая вам самому решать, заинтересованы вы в них или нет. То же самое касается и обменов с предметами, не соответствующими `MatchableTypes`, и прочих случаев - модуль обменов призван помочь автоматизировать обмены по алгоритму STM, а не решать за вас, какой обмен хороший а какой нет. Единственное исключение из этого правила - когда речь идет о пользователях, которых вы занесли в черный список из торгового модуля с помощью команды `tbadd` - сделки с этими пользователями немедленно отклоняются независимо от настроек `BotBehaviour`.

Настоятельно рекомендуем использовать **[2ФА ASF](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Two-factor-authentication-ru-RU)** если вы решите использовать этот функционал, поскольку он не раскрывает полностью свой потенциал если вам приходится вручную подтверждать каждый обмен. `SteamTradeMatcher` будет работать даже без возможности подтверждать обмены, но это может создать очередь на подтверждение если вы не принимаете их своевременно.