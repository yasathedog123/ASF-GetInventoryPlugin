# Компиляция

Компиляция - это процесс создания исполняемого файла. Это то, что вы хотите сделать, если хотите добавить свои собственные изменения в ASF или если по какой-либо причине вы не доверяете исполняемым файлам, указанным в официальных **[выпусках](https://github.com/JustArchiNET/ArchiSteamFarm/releases)**. Если вы пользователь, а не разработчик, скорее всего, вы хотите использовать уже предварительно скомпилированные двоичные файлы, но если вы хотите использовать свои собственные или узнать что-то новое, продолжайте читать.

ASF может быть скомпилирован на любой поддерживаемой платформе, если у вас есть все необходимые для этого инструменты.

---

## .NET SDK

Независимо от платформы, для компиляции ASF необходим полный .NET SDK (а не только среда выполнения). Инструкции по установке можно найти на **[странице загрузки .NET Core](https://dotnet.microsoft.com/download)**. Вам необходимо установить подходящую версию .NET SDK для вашей ОС. После успешной установки, команда `dotnet` должна быть полностью работоспособна. Вы можете проверить, работает ли она, вызвав `dotnet --info`. Также убедитесь, что ваш .NET SDK соответствует **[требованиям среде выполнения](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Compatibility-ru-RU#user-content-Требования-среды-исполнения)** ASF.

---

## Компиляция

Если у вас есть работоспособное .NET SDK нужной версии, просто перейдите в папку с исходниками ASF (клонированный или скачанный и распакованный репозиторий ASF) и запустите:

```shell
dotnet publish ArchiSteamFarm -c "Release" -f "net7.0" -o "out/generic"
```

Если вы используете MacOS/Linux, используйте вместо этого скрипт `cc.sh`, который сделает то же самое, но несколько более сложным методом.

Если компиляция завершилась успешно, вы можете найти свой ASF в варианте `source` в папке `out/generic`. Это то же самое, что и официальная сборка ASF в варианте `generic`, но в ней принудительно установлены равными `0` параметры `UpdateChannel` и `UpdatePeriod`, как и положено для самостоятельной сборки.

### Сборка под конкретные ОС

Вы также можете создать пакеты .NET для конкретных ОС, если у вас есть такая потребность. Обычно вы не должны этого делать, потому что вы только что скомпилировали вариант `generic`, который вы можете запустить с уже установленной средой выполнения .NET, которую вы только что использовали для компиляции, но на случай, если вы этого хотите:

```shell
dotnet publish ArchiSteamFarm -c "Release" -f "net7.0" -o "out/linux-x64" -r "linux-x64"
```

Разумеется, замените `linux-x64` на нужное вам сочетание ОС и архитектуры, например `win-x64`. Обновления этой сборки также будут отключены.

### .NET Framework

В очень редком случае, когда вы захотите создать сборку `generic-netf`, вы можете изменить целевой фреймворк с `net7.0` на `net481`. Имейте в виду, что для компиляции в варианте `netf`, в дополнение к .NET SDK, вам потребуется соответствующий пакет **[.NET Framework](https://dotnet.microsoft.com/download/visual-studio-sdks)**, поэтому следующая команда сработает только под Windows:

```shell
dotnet publish ArchiSteamFarm -c "Release" -f "net481" -o "out/generic-netf"
```

В случае, если вы не можете установить .NET Framework или даже сам .NET SDK (например, из-за сборки в системе `linux-x86` под `mono`), вы можете вызвать `msbuild` напрямую. Вам понадобиться вручную указать `ASFNetFramework`, поскольку ASF по умолчанию деактивирует сборку варианта `netf` на платформах, отличных от Windows:

```shell
msbuild /m /r /t:Publish /p:Configuration=Release /p:TargetFramework=net481 /p:PublishDir=out/generic-netf /p:ASFNetFramework=true ArchiSteamFarm
```

### ASF-ui

Хотя вышеперечисленные шаги являются всем, что требуется для полной рабочей сборки ASF, вы также *возможно* захотите собрать **[ASF-ui](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/IPC#asf-ui)**, наш графический веб-интерфейс. Все, что вам нужно с ASF, это скопировать результат сборки ASF-ui в стандартную директорию `ASF-ui/dist`, а потом собрать ASF (опять-таки, если это необходимо).

ASF-ui является частью дерева ASF в виде ** [ git submodule ](https://git-scm.com/book/en/v2/Git-Tools-Submodules) **, убедитесь, что вы клонировали репозиторий с помощью ` git clone --recursive `, иначе у вас не будет необходимых файлов. Вам также понадобится рабочий NPM, с ним поставляется ** [ Node.js ](https://nodejs.org) **. Если вы используете Linux/macOS, мы рекомендуем наш скрипт `cc.sh`, который автоматически соберет и установит ASF-ui (если всё соответствует требованиям, которые мы только что упомянули).

В дополнение к скрипту `cc.sh`, мы также приложим упрощенные инструкции по сборке ниже, см. **[ASF-ui repo](https://github.com/JustArchiNET/ASF-ui)** для дополнительной документации. Из корневой директории ASF выполните следующие команды:

```shell
rm -rf "ASF-ui/dist" # ASF-ui не удаялется после старой сборки

npm ci --prefix ASF-ui
npm run-script deploy --prefix ASF-ui

rm -rf "out/generic/www" # Убедитесь, что выходные данные сборки не содержат старых файлов
dotnet publish ArchiSteamFarm -c "Release" -f "net7.0" -o "out/generic" # Или то что вам нужно, из указаного выше
```

Теперь вы сможете найти файлы ASF-ui в папке `out/generic/www`. ASF сможет передать эти файлы вашему браузеру.

В качестве альтернативы вы можете просто собрать ASF-ui вручную или с помощью нашего репозитория, а затем вручную скопировать сборку в папку `${OUT}/www`, где `${OUT}` - это папка вывода ASF, которую вы указали с помощью параметра `-o`. Именно это и делает ASF в процессе сборки: он копирует `ASF-ui/dist` (если существует) в `${OUT}/www`, ничего особенного.

---

## Разработка

Если вы хотите изменить код ASF, для этой цели вы можете использовать любую совместимую с .NET IDE, хотя даже это необязательно, поскольку вы также можете редактировать код с помощью блокнота и компилировать его командой `dotnet`, как описано выше. Тем не менее, для Windows мы рекомендуем **[последнюю версию Visual Studio](https://visualstudio.microsoft.com/downloads)** (бесплатной community version более чем достаточно).

Если вы хотите работать с кодом ASF на Linux/macOS, мы рекомендуем **[последнюю версию Visual Studio Code](https://code.visualstudio.com/download)**. Оно не обладает такими возможностями как классическая Visual Studio, но и этого вполне достаточно.

Разумеется, всё предложенное выше это только наши рекоммендации, вы можете использовать что угодно, всё равно это в конце концов сводится к команде `dotnet build`. Мы используем **[JetBrains Rider](https://www.jetbrains.com/rider)** для разработки ASF, хотя это не бесплатное решение.

---

## Теги

Не гарантируется, что ветвь `main` будет находиться в состоянии, позволяющем произвести успешную компиляцию, или даже безошибочную работу ASF, поскольку это ветвь в которой ведётся разработка, как указано в статье **[Цикл выпуска](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Release-cycle-ru-RU)**. Если вы хотите скомпилировать ASF из исходного кода, или сослаться на исходный код ASF в своём проекте, вам следует использовать для этого соответствующий **[тег](https://github.com/JustArchiNET/ArchiSteamFarm/tags)**, что гарантирует как минимум успешную компиляцию, и скорее всего - безошибочную работу (если эта сборка отмечена как стабильная). Чтобы проверить текущее «состояние» дерева, вы можете использовать наш CI - **[GitHub](https://github.com/JustArchiNET/ArchiSteamFarm/actions/workflows/ci.yml?query=branch%3Amain)**.

---

## Официальные версии

Официальные выпуски ASF скомпилированы **[GitHub](https://github.com/JustArchiNET/ArchiSteamFarm/actions)** для Windows с последним .NET SDK, который соответствует **[требованиям среды выполнения](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Compatibility-ru-RU#user-content-Требования-среды-исполнения)** ASF. После успешного прохождения тестов, все пакеты загружаются в виде готового выпуска, также на GitHub. Это гарантирует прозрачность, поскольку GitHub всегда использует официальный публичный исходный код для всех сборок, и вы можете сравнить контрольные суммы артефактов GitHub с файлами выпуска на GitHub. Разработчики ASF не компилируют и не публикуют сборки самостоятельно, за исключением индивидуального процесса разработки и отладки.

Начиная с ASF V5.2.0.5, в дополнение к вышесказанному, специалисты по обслуживанию ASF вручную проверяют и публикуют контрольные суммы сборки независимо от GitHub, удаленного сервера, в качестве дополнительной меры безопасности. Этот шаг является обязательным для ASF, чтобы считать выпуск как допустимого кандидата для функции автоматического обновления.