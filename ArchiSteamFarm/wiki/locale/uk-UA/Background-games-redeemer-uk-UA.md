# Активація ігор у фоновому режимі

Активація у фоновому режимі - це спеціальна вбудована функція ASF, яка дозволяє імпортувати певний набір ключів Steam (разом з їх іменами) для активації у фоновому режимі. Це особливо корисно, якщо у вас є багато ключів для викупу і ви гарантовано досягнете `RateLimited` **[status](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/FAQ#what-is-the-meaning-of-status-when-redeeming-a-key)** до того, як закінчите викуповувати всю партію.

Активатор фонових ігор має єдину область видимості бота, що означає, що він не використовує `RedeemingPreferences`. Цю функцію можна використовувати разом з (або замість) `redeem` **[command](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/Commands)**, якщо це необхідно.

---

## Імпорт

Процес імпорту можна виконати двома способами - або за допомогою файлу, або за допомогою IPC.

### Файл

ASF розпізнає у своєму каталозі `config` файл з назвою `BotName.keys`, де `BotName` - ім'я вашого бота. Цей файл має очікувану і фіксовану структуру назви гри з cd-ключем, відокремлені один від одного символом табуляції і закінчуються новим рядком для позначення наступного запису. Якщо використовується декілька вкладок, то перший запис вважається назвою гри, останній - cd-ключем, а все, що між ними, ігнорується. Наприклад:

```text
POSTAL 2    ABCDE-EFGHJ-IJKLM
Domino Craft VR 12345-67890-ZXCVB
A Week of Circus Terror POIUY-KJHGD-QWERT
Terraria    ThisIsIgnored   ThisIsIgnoredToo    ZXCVB-ASDFG-QWERT
```

Крім того, ви також можете використовувати формат "тільки ключі" (але з переходом на новий рядок між кожним записом). ASF у цьому випадку використає відповідь Steam (якщо це можливо), щоб заповнити правильне ім'я. Для будь-якого типу тегування ключів ми рекомендуємо вам називати ключі самостійно, оскільки пакунки, які викуповуються в Steam, не повинні слідувати логіці ігор, які вони активують, тому, залежно від того, що написав розробник, ви можете побачити правильні назви ігор, нестандартні назви пакунків (наприклад, Humble Indie Bundle 18) або зовсім неправильні і потенційно навіть шкідливі (наприклад, Half-Life 4).

```text
ABCDE-EFGHJ-IJKLM
12345-67890-ZXCVB
POIUY-KJHGD-QWERT
ZXCVB-ASDFG-QWERT
```

Незалежно від того, якого формату ви вирішили дотримуватися, ASF імпортує ваш файл `keys` або під час запуску бота, або пізніше під час виконання. Після успішного розбору вашого файлу і можливого вилучення невірних записів, усі правильно виявлені ігри буде додано до фонової черги, а сам файл `BotName.keys` буде вилучено з каталогу `config`.

### IPC

На додаток до використання вищезгаданого файлу ключів, ASF також відкриває `GamesToRedeemInBackground` **[кінцеву точку API ASF](https://github.com/JustArchiNET/ArchiSteamFarm/wiki/IPC#asf-api)**, яка може бути виконана будь-яким IPC-інструментом, включаючи наш ASF-ui. Використання IPC може бути більш ефективним, оскільки ви можете самостійно виконувати відповідний синтаксичний аналіз, наприклад, використовувати власний роздільник замість примусового символу табуляції, або навіть вводити власну структуру клавіш, що налаштовується.

---

## Черга

Після успішного імпорту гри додаються до черги. ASF автоматично проходить через свою фонову чергу, поки бот підключений до мережі Steam, і черга не порожня. Ключ, який намагалися викупити, але це не призвело до `RateLimited`, вилучається з черги, а його статус належним чином записується у файл у каталозі `config` - або `BotName. keys.used`, якщо ключ було використано у процесі (наприклад, `NoDetail`, `BadActivationCode`, `DuplicateActivationCode`), або `BotName.keys.unused` в іншому випадку. ASF навмисно використовує надану вами назву гри, оскільки мережа Steam не гарантує, що ключ матиме осмислене ім'я, повернуте мережею - таким чином, ви можете тегувати свої ключі, використовуючи навіть власні імена, якщо це необхідно/бажано.

Якщо в процесі обробки наш акаунт отримує статус `RateLimited`, черга тимчасово призупиняється на цілу годину для того, щоб дочекатися, поки зникне холодний період. Після цього процес продовжується з того місця, де він зупинився, доки вся черга не стане порожньою або не виникне інше `RateLimited`.

---

## Приклад

Припустимо, у вас є список зі 100 ключів. По-перше, ви повинні створити новий файл `BotName.keys.new` у каталозі ASF `config`. Ми додали розширення `.new`, щоб повідомити ASF, що він не повинен підхоплювати цей файл одразу після його створення (оскільки це новий порожній файл, ще не готовий до імпорту).

Тепер ви можете відкрити наш новий файл і скопіювати туди список наших 100 ключів, виправивши формат, якщо потрібно. Після виправлення наш файл `BotName.keys.new` матиме рівно 100 (або 101, з останнім переходом на новий рядок) рядків, кожен з яких має структуру `GameName\tcd-key\n`, де `\t` - символ табуляції, а `\n` - переведення рядка.

Тепер ви можете перейменувати цей файл з `BotName.keys.new` на `BotName.keys`, щоб повідомити ASF, що він готовий до завантаження. Як тільки ви це зробите, ASF автоматично імпортує файл (без необхідності перезапуску), а потім видалить його, підтвердивши, що всі наші ігри було проаналізовано і додано до черги.

Замість використання файлу `BotName.keys`, ви також можете використовувати кінцеву точку IPC API, або навіть комбінувати обидва варіанти, якщо хочете.

Через деякий час буде згенеровано файли `BotName.keys.used` та `BotName.keys.unused`. Ці файли містять результати нашого процесу викупу. Наприклад, ви можете перейменувати файл `BotName.keys.unused` у `BotName2.keys` і таким чином передати наші невикористані ключі для іншого бота, оскільки попередній бот не використовував ці ключі сам. Або ви можете просто скопіювати і вставити невикористані ключі в інший файл і зберегти його на потім, на ваш розсуд. Майте на увазі, що коли ASF проходить через чергу, до наших вихідних файлів `used` і `unused` будуть додаватися нові записи, тому рекомендується дочекатися повного очищення черги, перш ніж використовувати їх. Якщо вам вкрай необхідно отримати доступ до цих файлів до того, як черга буде повністю очищена, вам слід спочатку **перемістити** вихідний файл, до якого ви хочете отримати доступ, до іншого каталогу, **а потім** проаналізувати його. Це пов'язано з тим, що ASF може додавати нові результати, поки ви робите свою роботу, і це може призвести до втрати деяких ключів, якщо ви прочитаєте файл, що містить, наприклад, 3 ключі, а потім видалите його, не помітивши, що за цей час ASF додав ще 4 ключі до видаленого вами файлу. Якщо ви хочете отримати доступ до цих файлів, перед читанням переконайтеся, що вилучили їх з каталогу ASF `config`, наприклад, перейменувавши.

Також можна додати додаткові ігри для імпорту, коли деякі ігри вже стоять у черзі, повторивши всі вищеописані кроки. ASF належним чином додасть наші додаткові заявки до вже існуючої черги і врешті-решт розбереться з цим.

---

## Зауваження

Викуповувач фонових ключів використовує `OrderedDictionary`, що означає, що ваші cd-ключі будуть збережені в тому порядку, в якому вони були вказані у файлі (або виклику IPC API). Це означає, що ви можете (і повинні) надати список, у якому даний cd-ключ може мати пряму залежність лише від cd-ключів, перелічених вище, але не нижче. Наприклад, це означає, що якщо у вас є DLC `D`, який вимагає попередньої активації гри `G`, то cd-ключ для гри `G` повинен **завжди** бути включений перед cd-ключем для DLC `D`. Аналогічно, якщо DLC `D` матиме залежності від `A`, `B` і `C`, то всі 3 повинні бути включені раніше (у будь-якому порядку, якщо тільки вони не мають власних залежностей).

Невиконання наведеної вище схеми призведе до того, що ваш DLC не буде активовано з `DoesNotOwnRequiredApp`, навіть якщо ваш акаунт має право на його активацію після проходження всієї черги. Якщо ви хочете уникнути цього, ви повинні переконатися, що ваш DLC завжди стоїть у черзі після базової гри.